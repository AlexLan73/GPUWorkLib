#pragma once

/**
 * @file config_types.hpp
 * @brief GPUConfigEntry — типы конфигурации для устройств GPU
 *
 * ============================================================================
 * НАЗНАЧЕНИЕ:
 *   Определяет структуру конфигурации для каждого устройства GPU.
 *   Используется GPUConfig для загрузки/сохранения configGPU.json.
 *
 * ПРИНЦИП ПРОЕКТИРОВАНИЯ:
 *   У каждого поля есть значение по УМОЛЧАНИЮ. Если поля нет в JSON,
 *   подставляется значение по умолчанию. Это обеспечивает совместимость
 *   при добавлении новых полей в будущем.
 *
 * ПРИМЕР JSON:
 *   {
 *     "id": 0,
 *     "name": "Alex",
 *     "is_prof": true,
 *     "is_logger": true
 *   }
 *   // is_console по умолчанию false, is_active по умолчанию true и т.д.
 *
 * ============================================================================
 *
 * @author Codo (AI Assistant)
 * @date 2026-02-07
 */

#include <string>
#include <cstddef>
#include <vector>


namespace drv_gpu_lib {

// ============================================================================
// GPUConfigEntry — конфигурация для одного GPU-устройства
// ============================================================================

/**
 * @struct GPUConfigEntry
 * @brief Параметры конфигурации для одного GPU
 *
 * У всех полей есть значения по умолчанию. При загрузке из JSON
 * отсутствующие поля получают значение по умолчанию.
 *
 * Смысл полей:
 * - id: индекс устройства GPU (с 0, совпадает с OpenCL device index)
 * - name: человекочитаемое имя (для логов, консоли, отладки)
 * - is_prof: включить профилирование GPU для этого устройства
 * - is_logger: включить файловое логирование для этого устройства
 * - is_console: включить вывод в консоль для этого устройства
 * - is_active: инициализировать ли этот GPU при старте
 * - is_db: вывод в БД (будущая возможность)
 * - max_memory_percent: макс. использование памяти GPU (% от общей)
 * - log_level: минимальный уровень лога ("DEBUG", "INFO", "WARNING", "ERROR")
 */
struct GPUConfigEntry {
    // ========================================================================
    // Идентификация
    // ========================================================================

    /// Индекс устройства GPU (с 0, соответствует OpenCL device index)
    int id = 0;

    /// Человекочитаемое имя GPU (в логах и консоли)
    std::string name = "GPU";

    // ========================================================================
    // Флаги возможностей (по умолчанию false для безопасности)
    // ========================================================================

    /// Включить сбор данных профилирования для этого GPU
    /// При true записываются время выполнения ядер и статистика памяти
    bool is_prof = false;

    /// Включить файловое логирование для этого GPU
    /// При true файлы логов: ${path}/Logs/DRVGPU_XX/YYYY-MM-DD/HH-MM-SS.log
    bool is_logger = false;

    /// Включить вывод в консоль для этого GPU
    /// При true сообщения этого GPU выводятся в stdout
    bool is_console = false;

    /// Активен ли этот GPU и должен ли инициализироваться
    /// false — пропустить при GPUManager::InitializeAll()
    bool is_active = true;

    /// Вывод в БД (будущая возможность)
    bool is_db = false;

    // ========================================================================
    // Лимиты ресурсов
    // ========================================================================

    /// Максимальная доля памяти GPU (процент от общей глобальной памяти)
    /// Используется BatchManager для расчёта размеров пакетов
    /// По умолчанию: 70% (с запасом для ОС и других процессов)
    size_t max_memory_percent = 70;

    // ========================================================================
    // Настройки логирования
    // ========================================================================

    /// Минимальный уровень лога для этого GPU
    /// Варианты: "DEBUG", "INFO", "WARNING", "ERROR"
    /// По умолчанию: "INFO" (в продакшене отладочные сообщения не пишутся)
    std::string log_level = "INFO";
};

// ============================================================================
// GPUConfigData — корневая структура конфигурации
// ============================================================================

/**
 * @struct GPUConfigData
 * @brief Корневая структура для configGPU.json
 *
 * Содержит версию и список конфигураций GPU.
 */
struct GPUConfigData {
    /// Версия формата файла конфигурации
    std::string version = "1.0";

    /// Человекочитаемое описание
    std::string description = "GPU Configuration for DrvGPU";

    /// Список конфигураций GPU
    std::vector<GPUConfigEntry> gpus;
};

} // namespace drv_gpu_lib
